<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="WWW::AdventCalendar v1.113" />
    <link rel="alternate" title="Perl Advent Calendar 2017 XML feed" href="atom.xml" type="application/atom+xml" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="2017.css" type="text/css" />
    <title>
Perl Advent Calendar 2017 - 
For Elves, Shorter is Better

</title>
</head>
<body>
    <div id="contentwrapper">
        <div id="header">
            <h1><a href="index.html">Perl Advent Calendar 2017</a></h1>
        </div>

        <p id="tagline">2017 twenty four merry days of Perl
         <a class='feed' href="atom.xml">Feed</a>
        </p>

        <div id="content">
          

<h1 class='title'>For Elves, Shorter is Better</h1>
<div class='subtitle'>MooseX::AttributeShortcuts - 2017-12-16</div>

<div class='pod'><p>One of the problems in being the Wise Old Elf was, well, the <i>old</i> part. The Wise Old Elf had been typing for so many years - rushing every Christmas - that he&#39;d developed a case of RSI that flared up at the most inconvenient times.</p>

<p>As such, he was always looking for ways to avoid typing so much, and this Christmas, he thought he&#39;d found one.</p>

<h3 id="Verbose.-Verbosity.-So-long-winded.-On-and-On">Verbose. Verbosity. So long winded. On and On.</h3>

<p>One of the problems with Moose in its default configuration is that it can be, well, a little wordy...</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="word">has</span> <span class="word">lead_reindeer</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span>      <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa</span>     <span class="operator">=&gt;</span> <span class="word">class_type</span><span class="structure">(</span><span class="single">'SantasReindeer'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">lazy</span>    <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">builder</span> <span class="operator">=&gt;</span> <span class="single">'_build_lead_reindeer'</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="word">has</span> <span class="word">second_reindeer</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span>      <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa</span>     <span class="operator">=&gt;</span> <span class="word">class_type</span><span class="structure">(</span><span class="single">'SantasReindeer'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">lazy</span>    <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">builder</span> <span class="operator">=&gt;</span> <span class="single">'_build_second_reindeer'</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="word">has</span> <span class="word">third_reindeer</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span>      <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa</span>     <span class="operator">=&gt;</span> <span class="word">class_type</span><span class="structure">(</span><span class="single">'SantasReindeer'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">lazy</span>    <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">builder</span> <span class="operator">=&gt;</span> <span class="single">'_build_third_reindeer'</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="word">has</span> <span class="word">forth_reindeer</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span>      <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa</span>     <span class="operator">=&gt;</span> <span class="word">class_type</span><span class="structure">(</span><span class="single">'SantasReindeer'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">lazy</span>    <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">builder</span> <span class="operator">=&gt;</span> <span class="single">'_build_forth_reindeer'</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="operator">...</span><span class="structure">;</span>  <span class="comment"># and on and on for another five reindeer!</span></code><br />&nbsp;</td></table>

<p>Putting aside the fact that this is probably better written using some sort of array data structure (which is literally an article for another day) what can be done to make this less verbose?</p>

<h3 id="Enter-MooseX::AttributeShortcuts">Enter MooseX::AttributeShortcuts</h3>

<p>Why, yes, we can make this much shorter, with the help of the <a href="https://metacpan.org/module/MooseX::AttributeShortcuts">MooseX::AttributeShortcuts</a> CPAN module:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">use</span> <span class="word">MooseX::AttributeShortcuts</span><span class="structure">;</span><br /><br /><span class="word">has</span> <span class="structure">[</span><span class="words">qw(<br />&nbsp;&nbsp;lead_reindeer second_reindeer third_reindeer forth_reindeer<br />&nbsp;&nbsp;fifth_reindeer sixth_reindeer seveth_reindeer eighth_reindeer<br />)</span><span class="structure">]</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span>              <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa_instance_of</span> <span class="operator">=&gt;</span> <span class="single">'SantasReindeer'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">lazy</span>            <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">builder</span>         <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br /><span class="structure">);</span></code><br />&nbsp;</td></table>

<p>Loading MooseX::AttributeShortcuts into your Moose class enables a whole bunch of extra parameter handing for <code>has</code> that provides shortcuts to make writing attribute code simpler. In the above example we see two such shortcuts: The first shortcut, writing <code>isa_instance_of =&gt; &#39;SantasReindeer&#39;</code> instead of <code>isa =&gt; class_type(&#39;SantasReindeer&#39;)</code> provides us a little win, the biggest reduction in code comes from <code>builder =&gt; 1</code>. By setting the builder to a plain old <code>1</code> we&#39;re letting MooseX::AttributeShortcuts tell Moose that we want to use the default name for our builder - whatever the accessor is called with <code>_build_</code> prepended to it. And because now we don&#39;t need a custom builder parameter for each attribute, we can declare all nine in a single <code>has</code> declaration!</p>

<p>Can we make this shorter still? Yep! We can just say, like with <a href="https://metacpan.org/module/Moo">Moo</a>, that this is <code>lazy</code>.</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="word">has</span> <span class="structure">[</span><span class="words">qw(<br />&nbsp;&nbsp;lead_reindeer second_reindeer third_reindeer forth_reindeer<br />&nbsp;&nbsp;fifth_reindeer sixth_reindeer seveth_reindeer eighth_reindeer<br />)</span><span class="structure">]</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span>              <span class="operator">=&gt;</span> <span class="single">'lazy'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa_instance_of</span> <span class="operator">=&gt;</span> <span class="single">'SantasReindeer'</span><span class="operator">,</span><br /><span class="structure">);</span></code><br />&nbsp;</td></table>

<p>That shortcut create a read only accessor that is lazy and uses the default Moose accessor.</p>

<p>In addition to <code>lazy</code>, MooseX::AttributeShortcuts also accepts <code>is =&gt; &#39;rwp&#39;</code>. <code>rwp</code> creates a public reader accessor of the form <code>foo</code> and a private writer accessor of the form <code>_set_foo</code> (since by convention in Perl methods starting with an underscore are private and shouldn&#39;t be called from outside of the class.)</p>

<h3 id="Custom-Anonymous-Types">Custom Anonymous Types</h3>

<p>It would be nice to make sure that the lead reindeer has a glowing nose, but that would probably involve a custom type class to check the value&#39;s <code>glowing_nose</code> attribute:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">NorthPole::Types</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">MooseX::Types</span> <span class="word">-declare</span> <span class="operator">=&gt;</span> <span class="structure">[</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="words">qw(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SantasReindeerWithAGlowingNose<br />&nbsp;&nbsp;&nbsp;&nbsp;)</span><br /><span class="structure">];</span><br /><br /><span class="word">subtype</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">SantasReindeerWithAGlowingNose</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">as</span> <span class="word">class_type</span><span class="structure">(</span><span class="single">'SantasReindeer'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">where</span> <span class="structure">{}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">inline_as</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="magic">$_</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">parent</span><span class="structure">()</span><span class="operator">-&gt;</span><span class="word">_inline_check</span><span class="structure">(</span> <span class="magic">$_</span><span class="structure">[</span><span class="number">1</span><span class="structure">]</span> <span class="structure">)</span> <span class="operator">.</span> <span class="double">&quot; &amp;&amp; $_[1]-&gt;glowing_nose&quot;</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br /><span class="structure">);</span></code><br />&nbsp;</td></table>

<p>And then use that new type:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">use</span> <span class="word">NorthPole::Types</span> <span class="words">qw( SantasReindeerWithAGlowingNose )</span><span class="structure">;</span><br /><br /><span class="word">has</span> <span class="word">lead_reindeer</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span>  <span class="operator">=&gt;</span> <span class="single">'lazy'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="word">SantasReindeerWithAGlowingNose</span><span class="operator">,</span><br /><span class="structure">);</span></code><br />&nbsp;</td></table>

<p>That is a <b>lot</b> of typing if you&#39;re only going to use it in one place. How about we use another shortcut?</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="word">has</span> <span class="word">lead_reindeer</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span>  <span class="operator">=&gt;</span> <span class="single">'lazy'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">die</span> <span class="word">unless</span> <span class="word">blessed</span> <span class="operator">&amp;&amp;</span> <span class="magic">$_</span><span class="operator">-&gt;</span><span class="word">isa</span><span class="structure">(</span><span class="single">'SantasReindeer'</span><span class="structure">)</span> <span class="operator">&amp;&amp;</span> <span class="magic">$_</span><span class="operator">-&gt;</span><span class="word">glowing_nose</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span></code><br />&nbsp;</td></table>

<p>Here we&#39;re quickly defining a new one off type <i>inline</i>! It&#39;s not the most readable thing in the world though, is it? MooseX::AttributeShortcuts allows us to specify this in a more straight forward manner by allowing an inline <i>constraint</i>, which is an additional condition that will be checked for truthfulness after the <code>isa</code> / <code>isa_instance_of</code> check has occurred.</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="word">has</span> <span class="word">lead_reindeer</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span>              <span class="operator">=&gt;</span> <span class="single">'lazy'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa_instance_of</span> <span class="operator">=&gt;</span> <span class="single">'SantasReindeer'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">constraint</span>      <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span> <span class="magic">$_</span><span class="operator">-&gt;</span><span class="word">glowing_nose</span> <span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span></code><br />&nbsp;</td></table>

<p>As an added benefit writing a <code>constraint</code> / <code>isa</code> pair is that this subtypes the original type, meaning that coercions associated with the original type will just work!</p>

<h3 id="Much-much-more">Much much more</h3>

<p>The Wise Old Elf continued to read the documentation for MooseX::AttributeShortcuts finding out about all sorts of things, from easy trigger, clearer and predicate declaration through quickly defining inline coercions and builder methods. He, like you should, was going to spend a good afternoon playing with this module - not only to avoid so much typing, but also to avoid writing so much boilerplate code and reduce the potential for bugs.</p>

</div>

<div id='author'>
<img alt='Gravatar Image' style='vertical-align:middle' src=http://www.gravatar.com/avatar/5d71b5f0c61e97cd452d625cc24a4c82?r=g&s=80&d=retro />
This article contributed by: Mark Fowler &lt;mark@twoshortplanks.com&gt;
</div>


<ul id="pager">
    <li class="previous"><a title="Mojolicious on the Command Line" href="2017-12-15.html">Previous</a></li>

    <li class="next"><a title="Making a constructor argument list, checking it twice." href="2017-12-17.html">Next</a></li>
</ul>
<div style="clear: both"></div>

        </div>

    </div>



<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-27056407-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>





